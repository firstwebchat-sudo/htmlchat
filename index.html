<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Global Chat</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f0f0f0; margin: 0; padding: 0; }
    #login { padding: 20px; max-width: 400px; margin: 50px auto; background: white; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.2); }
    #chat { display: none; flex-direction: column; height: 90vh; max-width: 600px; margin: 20px auto; background: white; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.2); }
    #messages { flex: 1; overflow-y: auto; padding: 10px; }
    #messages p { margin: 5px 0; }
    #input-area { display: flex; padding: 10px; }
    #input-area input { flex: 1; padding: 10px; font-size: 16px; }
    #input-area button { padding: 10px; font-size: 16px; }
  </style>
</head>
<body>

<div id="login">
  <h2>Join Global Chat</h2>
  <input type="text" id="username" placeholder="Enter username" /><br><br>
  <input type="text" id="room" placeholder="Enter room password" /><br><br>
  <button id="joinBtn">Join Chat</button>
</div>

<div id="chat">
  <div id="messages"></div>
  <div id="input-area">
    <input type="text" id="messageInput" placeholder="Type a message..." />
    <button id="sendBtn">Send</button>
  </div>
</div>

<script type="module">
  // ---------------- Firebase Setup ----------------
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
  import { getDatabase, ref, push, onValue } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-database.js";

  // ======= PASTE YOUR FIREBASE CONFIG HERE =======
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT.firebaseapp.com",
    databaseURL: "https://YOUR_PROJECT-default-rtdb.firebaseio.com",
    projectId: "YOUR_PROJECT",
    storageBucket: "YOUR_PROJECT.appspot.com",
    messagingSenderId: "YOUR_SENDER_ID",
    appId: "YOUR_APP_ID"
  };
  // ================================================

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  // ---------------- Chat Setup ----------------
  const loginDiv = document.getElementById('login');
  const chatDiv = document.getElementById('chat');
  const usernameInput = document.getElementById('username');
  const roomInput = document.getElementById('room');
  const joinBtn = document.getElementById('joinBtn');
  const messagesDiv = document.getElementById('messages');
  const messageInput = document.getElementById('messageInput');
  const sendBtn = document.getElementById('sendBtn');

  const userColors = {}; // store username => color mapping
  const colors = ['red','green','blue','orange','purple','teal','brown','pink'];

  let username = '';
  let room = '';

  function getColor(name) {
    if(userColors[name]) return userColors[name];
    const color = colors[Object.keys(userColors).length % colors.length];
    userColors[name] = color;
    return color;
  }

  joinBtn.onclick = () => {
    username = usernameInput.value.trim();
    room = roomInput.value.trim();
    if(!username || !room) return alert("Enter username and room password");
    loginDiv.style.display = 'none';
    chatDiv.style.display = 'flex';
    loadMessages();
  };

  sendBtn.onclick = sendMessage;
  messageInput.addEventListener('keypress', (e) => { if(e.key==='Enter') sendMessage(); });

  function sendMessage() {
    const text = messageInput.value.trim();
    if(!text) return;
    push(ref(db, `rooms/${room}/messages`), { user: username, text: text });
    messageInput.value = '';
  }

  function loadMessages() {
    const messagesRef = ref(db, `rooms/${room}/messages`);
    onValue(messagesRef, (snapshot) => {
      messagesDiv.innerHTML = '';
      snapshot.forEach((child) => {
        const data = child.val();
        const p = document.createElement('p');
        p.innerHTML = `<b style="color:${getColor(data.user)}">${data.user}:</b> ${data.text}`;
        messagesDiv.appendChild(p);
      });
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    });
  }
</script>

</body>
</html>
